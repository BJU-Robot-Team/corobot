<launch>


<!--***** ROBOT *****-->

<!-- Note that it is assumed that if you don't have an explorer or a corobot 4 wheel drive you have a corobot 2 wheel drive -->
<arg name="Explorer" value="0"/> <!-- 1 if you have a Corobot Explorer, 0 if you have a Corobot Classic -->
<arg name="Corobot4WD" value="0"/> <!-- 1 if you have a Corobot with 4 Wheel Drive -->


<!--***** Phidget Motor Controller *****-->

<arg name="PhidgetMotorController" value="1"/> <!-- 1 if you have the Phidget Motor Controller, 0 if you don't -->
<arg name="motors_inverted" value="0"/> <!-- 1 if you want to invert the motors, 0 if not. This is used only in the case where the robot can turn properly but the forward and backward movement are inverted (by testing in the corobot_teleop package for example). It also invert the encoders at the same time-->
<arg name="encoders_inverted" value="0"/> <!-- 1 if you want to invert the encoders, 0 if not. This is used when the odometry give a negative x position when the robot moves forward-->

<arg name="twistCommand" value="0"/> <!-- 1 if you want to enable commanding the robot with twist messages, 0 if you don't -->



  <group if="$(arg PhidgetMotorController)">
    <node pkg="phidget_motor" name="phidget_motor" type="PhidgetMotor.py" args="">
	<param name="motors_inverted" type="bool" value="$(arg motors_inverted)"/>
	<param name="encoders_inverted" type="bool" value="$(arg encoders_inverted)"/>
    </node>

	<node pkg="corobot_state_tf" name="corobot_state_tf" type="corobot_state_tf">
		<param name="Explorer" type="bool" value="$(arg Explorer)"/>
		<param name="Corobot4WD" type="bool" value="$(arg Corobot4WD)"/>
		<param name="publish_odom_tf" type="bool" value="1"/>
	</node>
  </group>




	<group if="$(arg twistCommand)">
		<rosparam param="ticks_meter">7570</rosparam>

			<node pkg="differential_drive" type="pid_velocity.py" name="lpid_velocity">
			    <remap from="wheel" to="lwheel"/>
			    <remap from="motor_cmd" to="lmotor_cmd"/>
			    <remap from="wheel_vtarget" to="lwheel_vtarget"/>
			    <remap from="wheel_vel" to="lwheel_vel"/>
			    <rosparam param="Kp">100</rosparam>
			    <rosparam param="Ki">100</rosparam>
			    <rosparam param="Kd">0</rosparam>
			    <rosparam param="out_min">-100</rosparam>
			    <rosparam param="out_max">100</rosparam>
			    <rosparam param="rate">30</rosparam>
			    <rosparam param="timeout_ticks">4</rosparam>
			    <rosparam param="rolling_pts">5</rosparam>
			</node>
			<node pkg="differential_drive" type="pid_velocity.py" name="rpid_velocity">
			    <remap from="wheel" to="rwheel"/>
			    <remap from="motor_cmd" to="rmotor_cmd"/>
			    <remap from="wheel_vtarget" to="rwheel_vtarget"/>
			    <remap from="wheel_vel" to="rwheel_vel"/>
			    <rosparam param="Kp">100</rosparam>
			    <rosparam param="Ki">100</rosparam>
			    <rosparam param="Kd">0</rosparam>
			    <rosparam param="out_min">-100</rosparam>
			    <rosparam param="out_max">100</rosparam>
			    <rosparam param="rate">30</rosparam>
			    <rosparam param="timeout_ticks">4</rosparam>
			    <rosparam param="rolling_pts">5</rosparam>
			</node>

			<node pkg="differential_drive" type="twist_to_motors.py" name="twist_to_motors" output="screen">
			  <rosparam param="base_width">0.35</rosparam>
			</node>
  </group>


</launch>
